---
description: Heavy version of bot creation - 6 waves, 15+ agents, deep risk research, mandatory risk controls, dry run mode. Creates robust, safety-first trading bots.
argument-hint: "<strategy: market_maker|arbitrage|spike_detector|custom> [description]"
allowed-tools: Read, Write, Glob, Grep, Task, TodoWrite, AskUserQuestion, Skill
model: opus
---

# Create Strategy Bot Heavy

Create a robust, safety-first Polymarket trading bot using comprehensive research and deep verification.

**This is the HEAVY version** - uses 6 waves of research with 13+ specialized agents, focuses on risk management, includes mandatory safety controls, and verifies everything works.

## What Makes This "Heavy"

| Aspect | create_single_strategy_bot | create_strategy_bot_heavy |
|--------|---------------------------|---------------------------|
| Research waves | 1 | 6 |
| Total agents | 3 | 13+ |
| Risk research | None | Dedicated wave |
| Historical analysis | None | Famous failures + academic |
| Contrarian challenge | None | Dedicated agent |
| Risk controls | Optional | MANDATORY |
| Dry run mode | None | Built-in |
| Logic audit depth | Syntax check | Deep skeptical audit |

## Risk Controls (MANDATORY)

Every bot generated by this command includes:

1. **Position Limits** - Max per market and total
2. **Loss Limits** - Per trade, daily, and total
3. **Kill Switch** - Auto-triggers on loss limits
4. **Dry Run Mode** - Test without real money
5. **Rate Limiting** - Prevents API bans

**The bot REFUSES to start without risk parameters configured.**

## How to Use

```
/create_strategy_bot_heavy market_maker
/create_strategy_bot_heavy arbitrage
/create_strategy_bot_heavy spike_detector
/create_strategy_bot_heavy custom "I want to buy when price drops 10%"
```

---

## YOUR PROCESS

### Wave 0: Deep Strategy Interrogation

This happens BEFORE any research agents are spawned.

#### 0.1: Parse Strategy Type

**If preset** (`market_maker`, `arbitrage`, `spike_detector`):
- Load standard definition
- Still ask risk tolerance questions

**If custom** (including "custom" keyword or any other input):
- Full interrogation process

**If no argument**, ask:
```
What trading strategy would you like to implement?

**Preset options:**
- `market_maker` - Two-sided quotes to capture spread
- `arbitrage` - Exploit YES+NO pricing inefficiencies
- `spike_detector` - React to sudden price movements

**Or describe your custom strategy:**
Just tell me what you want the bot to do.
```

#### 0.2: MANDATORY Risk Tolerance Questions

**These questions are REQUIRED for all strategies, including presets.**

Use AskUserQuestion to ask these MANDATORY questions:

**Question 1: Position Limits**
- What is the MAXIMUM you want in any single market? (in $)
- What is the MAXIMUM you want across ALL markets combined? (in $)

**Question 2: Loss Limits**
- What is the MAXIMUM you're willing to lose on a SINGLE TRADE? (in $)
- What is the MAXIMUM you're willing to lose PER DAY? (bot stops trading)
- What is the MAXIMUM you're willing to lose TOTAL? (bot stops forever)

**Question 3: Operational**
- How aggressive should rate limiting be? (conservative/moderate/aggressive)

**Example conservative settings to suggest:**
- Max per market: $50
- Max total: $200
- Max per trade loss: $10
- Max daily loss: $25
- Max total loss: $100

**DO NOT PROCEED without explicit answers to ALL risk questions.**

#### 0.3: Confirm Understanding

Present full strategy spec including risk limits for confirmation:

```markdown
## Strategy Confirmation

### Strategy
[Strategy description]

### Risk Limits
| Parameter | Your Setting |
|-----------|--------------|
| Max position per market | $[X] |
| Max total position | $[X] |
| Max loss per trade | $[X] |
| Max daily loss | $[X] |
| Max total loss | $[X] |

### Kill Switch Triggers
The bot will STOP trading if:
- Daily loss exceeds $[max_daily_loss]
- Total loss exceeds $[max_total_loss]

### Dry Run
The bot will start in DRY RUN mode (simulation only).
You must explicitly enable live trading in .env.

**Is this correct?**
```

Wait for explicit confirmation.

#### 0.4: Write Strategy Specification

Write to: `thoughts/shared/polymarket-bot-specs/{timestamp}-{strategy}-heavy.md`

Include ALL risk parameters in the spec.

---

### Wave 1: Polymarket API Research (3 agents parallel, max 3)

Create a TodoWrite entry marking Wave 1 as in_progress.

Spawn these 3 agents IN PARALLEL using Task tool:

**Agent 1: polymarket-researcher**
```
Research Polymarket API implementation for: [STRATEGY]

Strategy Spec Location: thoughts/shared/polymarket-bot-specs/{filename}.md
READ THIS FILE FIRST.

Focus on:
1. Required API endpoints
2. SDK methods needed
3. Authentication requirements
4. Rate limits for this access pattern

Write findings to: thoughts/shared/polymarket-bot-specs/{filename}-api-research.md
```

**Agent 2: technical-researcher**
```
Research technical implementation patterns for: [STRATEGY TYPE] trading bots

Focus on:
1. Common architecture patterns
2. State management approaches
3. Error handling best practices
4. Monitoring and alerting patterns

Include code examples where available.
```

**Agent 3: web-search-researcher**
```
Research Polymarket trading bot implementations and discussions.

Search for:
- "Polymarket trading bot" implementations
- "Polymarket API" code examples
- py-clob-client usage examples
- Polymarket trader discussions

Focus on real-world implementation details and gotchas.
```

**WAIT for all 3 agents to complete before proceeding to Wave 2.**

---

### Wave 2: Risk & Historical Research (3 agents parallel, max 3)

Update TodoWrite - Wave 1 completed, Wave 2 in_progress.

Spawn these 3 agents IN PARALLEL:

**Agent 4: strategy-risk-researcher**
```
Research ALL risks for: [STRATEGY TYPE]

Strategy Spec: thoughts/shared/polymarket-bot-specs/{filename}.md
Risk Limits: [Include user's risk limits from Wave 0]

Find:
1. Strategy-specific failure modes
2. Market condition risks
3. Technical risks
4. Historical blowups of this strategy type

Output critical risks that the bot MUST handle.
```

**Agent 5: trading-bot-historian**
```
Research historical performance and failures for: [STRATEGY TYPE]

Find:
1. Academic research on this strategy
2. Famous successes and failures
3. Typical returns and risk metrics
4. Lessons from historical examples

Include specific examples with what went wrong/right.
```

**Agent 6: historical-precedent-researcher**
```
Find historical precedents for: [STRATEGY TYPE] trading strategies

Focus on:
1. Similar strategies that failed (why?)
2. Similar strategies that succeeded (what made them work?)
3. Base rate of success for this strategy type
4. Key differentiators between success and failure
```

**WAIT for all 3 agents to complete before proceeding to Wave 3.**

---

### Wave 3: Contrarian & Market Analysis (3 agents parallel, max 3)

Update TodoWrite - Wave 2 completed, Wave 3 in_progress.

Spawn these 3 agents IN PARALLEL:

**Agent 7: strategy-contrarian**
```
Find ALL reasons this strategy will FAIL: [STRATEGY TYPE]

Strategy Spec: thoughts/shared/polymarket-bot-specs/{filename}.md

Your job: ATTACK this strategy. Find:
1. Core assumption failures
2. Competitive disadvantages
3. Market conditions that kill it
4. Technical failure modes
5. Economic unviability scenarios

Be genuinely adversarial.
```

**Agent 8: financial-markets-researcher**
```
Research market dynamics relevant to: [STRATEGY TYPE] on Polymarket

Find:
1. Typical liquidity patterns on Polymarket
2. Spread dynamics and competition
3. Volume patterns by market type
4. Fee impact on profitability
5. Market maker competition analysis
```

**Agent 9: expert-opinion-researcher**
```
Find expert opinions on: [STRATEGY TYPE] trading strategies

Search for:
1. Academic experts on market making/arbitrage/etc.
2. Professional trader insights
3. Quantitative finance perspectives
4. Prediction market researchers

What do experts say about viability of this strategy?
```

**WAIT for all 3 agents to complete before proceeding to Wave 4.**

---

### Wave 4: Synthesis & Planning (Orchestrator - YOU)

Update TodoWrite - Wave 3 completed, Wave 4 in_progress.

**This wave is executed by YOU (the orchestrator), not spawned agents.**

#### 4.1: Synthesize All Research

Compile findings from Waves 1-3:

```markdown
## Research Synthesis

### API & Technical Findings
[Summary from Wave 1]

### Risk Assessment
**Critical Risks Identified:**
1. [Risk 1] - Mitigation: [How to handle]
2. [Risk 2] - Mitigation: [How to handle]
...

**Historical Lessons:**
[Summary from Wave 2]

### Contrarian Challenges
**Valid Concerns:**
1. [Concern 1] - Response: [How bot addresses]
2. [Concern 2] - Response: [How bot addresses]
...

**Concerns Requiring Additional Safeguards:**
[List any concerns that need extra safety measures]

### Strategy Viability Assessment
Based on research: [PROCEED / PROCEED WITH CAUTION / RECONSIDER]
```

#### 4.2: Risk Control Requirements

Based on research, define specific risk controls:

```markdown
## Required Risk Controls

### Position Controls
- [ ] Max position per market: $[X] (from user)
- [ ] Max total position: $[X] (from user)
- [ ] Position check before every order

### Loss Controls
- [ ] Max loss per trade: $[X] (from user)
- [ ] Daily loss limit: $[X] - triggers kill switch
- [ ] Total loss limit: $[X] - triggers kill switch
- [ ] P&L tracking for every trade

### Kill Switch Triggers
1. Daily loss exceeded
2. Total loss exceeded
3. [Any strategy-specific triggers from research]
4. Critical error detected
5. Manual kill signal

### Dry Run Requirements
- Default to DRY_RUN=true
- All order attempts logged
- Simulated position tracking
- Simulated P&L tracking
```

#### 4.3: Write Enhanced Specification

Update the strategy spec with all research findings and risk controls.

---

### Wave 5: Code Generation (1 agent)

Update TodoWrite - Wave 4 completed, Wave 5 in_progress.

**Agent 10: polymarket-bot-scaffolder**

Spawn scaffolder with enhanced requirements:

```
Create a ROBUST [STRATEGY TYPE] bot with full risk controls.

## Input Files (READ ALL)
1. Strategy Spec: thoughts/shared/polymarket-bot-specs/{filename}.md
2. API Research: thoughts/shared/polymarket-bot-specs/{filename}-api-research.md

## MANDATORY Requirements

### This is HEAVY mode - include these additional files:
- risk_manager.py (from heavy mode template)
- dry_run.py (from heavy mode template)
- logs/ directory

### Risk Manager
Include risk_manager.py with:
- RiskLimits dataclass loaded from env
- Position limit enforcement
- Loss limit enforcement
- Kill switch implementation
- Order rate limiting

### Dry Run Mode
Include dry_run.py with:
- Simulate orders without execution
- Log all simulated orders to file
- Track simulated positions
- Track simulated P&L

### Safety Features
- Bot MUST refuse to start without risk parameters
- Bot MUST start in DRY_RUN mode by default
- Bot MUST log all order attempts
- Bot MUST implement kill switch

## Output Directory
polymarket-bots/{strategy}-heavy/

Return complete file manifest.
```

**WAIT for scaffolding to complete before proceeding to Wave 6.**

---

### Wave 6: Deep Verification (3 agents parallel, max 3)

Update TodoWrite - Wave 5 completed, Wave 6 in_progress.

Spawn these 3 agents IN PARALLEL:

**Agent 11: bot-logic-auditor**
```
Audit the trading bot for SAFETY.

Bot Location: polymarket-bots/{strategy}-heavy/
Strategy Spec: thoughts/shared/polymarket-bot-specs/{filename}.md

## Critical Verifications

1. Position Limits: Verify limits are enforced on EVERY order
2. Loss Limits: Verify kill switch triggers correctly
3. Dry Run Mode: Verify no real orders in dry run
4. Kill Switch: Verify complete shutdown on trigger

Create verification scripts for each in temp-verify/.
Execute scripts and report results.

Verdict must be SAFE before proceeding.
```

**Agent 12: concern-evaluator**
```
Evaluate these specific concerns about the bot:

Bot Location: polymarket-bots/{strategy}-heavy/

Concerns to evaluate:
1. Can position limits be bypassed?
2. Can loss limits be bypassed?
3. Does dry run mode leak real orders?
4. Does kill switch actually stop ALL trading?
5. Are there any code paths that skip risk checks?

For each concern, trace the actual code to determine if it's valid.
```

**Agent 13: change-verifier**
```
Verify the bot works as a complete system.

Bot Location: polymarket-bots/{strategy}-heavy/

Create and execute verification for:
1. Bot starts successfully with valid config
2. Bot refuses to start without risk params
3. Dry run mode works end-to-end
4. Simulated orders are logged correctly
5. Kill switch can be triggered manually

Execute tests and report results.
```

**WAIT for all 3 agents to complete.**

---

### Wave 6.5: Verification Gate

Update TodoWrite - Wave 6 completed, Verification gate in_progress.

**IF ANY VERIFICATION FAILS:**
- Report specific failures to user
- Keep all verification scripts in temp-verify/
- Do NOT present as complete
- Ask if user wants to fix issues

**IF ALL VERIFICATIONS PASS:**
- Clean up verification scripts (optional, ask user)
- Proceed to final presentation

---

### Final: Present Results

Update TodoWrite - all tasks completed.

```markdown
## Bot Creation Complete (Heavy)

### Strategy
[Strategy name and description]

### Location
`polymarket-bots/{strategy}-heavy/`

### Risk Controls Implemented

| Control | Setting | Verified |
|---------|---------|----------|
| Max position/market | $[X] | [PASS/FAIL] |
| Max total position | $[X] | [PASS/FAIL] |
| Max loss/trade | $[X] | [PASS/FAIL] |
| Max daily loss | $[X] | [PASS/FAIL] |
| Max total loss | $[X] | [PASS/FAIL] |
| Kill switch | Enabled | [PASS/FAIL] |
| Dry run mode | Default ON | [PASS/FAIL] |

### Audit Results

| Verification | Agent | Result |
|--------------|-------|--------|
| Risk controls | bot-logic-auditor | [PASS/FAIL] |
| Safety concerns | concern-evaluator | [PASS/FAIL] |
| Integration | change-verifier | [PASS/FAIL] |

### Research Summary
- **Waves executed**: 6
- **Agents used**: [N]
- **Risks identified**: [N] (all mitigated)
- **Historical lessons applied**: [N]

### Files Created
[File manifest from scaffolder]

### Setup Instructions

1. Navigate to bot directory:
   ```bash
   cd polymarket-bots/{strategy}-heavy
   ```

2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

3. Configure risk parameters:
   ```bash
   cp .env.example .env
   # Edit .env with your risk limits
   ```

4. Run in DRY RUN mode first:
   ```bash
   python main.py
   # Check logs/dry_run/ for simulated orders
   ```

5. After validating dry run, enable live trading:
   ```bash
   # Edit .env: DRY_RUN=false
   # WARNING: Real money at risk!
   ```

### Critical Warnings

1. **START IN DRY RUN MODE** - Validate before live trading
2. **MONITOR CLOSELY** - Watch first live sessions carefully
3. **RESPECT LIMITS** - Your risk parameters are there for a reason
4. **KILL SWITCH EXISTS** - Bot will stop if limits are hit

### Research Documentation
- Strategy spec: thoughts/shared/polymarket-bot-specs/{filename}.md
- API research: thoughts/shared/polymarket-bot-specs/{filename}-api-research.md
```

---

## Progress Tracking

Use TodoWrite throughout to track progress:

```
1. Parse strategy input - [status]
2. Interrogate risk tolerance - [status]
3. Confirm understanding - [status]
4. Write strategy spec - [status]
5. Wave 1: API Research (3 agents) - [status]
6. Wave 2: Risk & Historical (3 agents) - [status]
7. Wave 3: Contrarian & Market (3 agents) - [status]
8. Wave 4: Synthesis & Planning - [status]
9. Wave 5: Code Generation - [status]
10. Wave 6: Deep Verification (3 agents) - [status]
11. Verification gate - [status]
12. Present results - [status]
```

---

## Critical Rules

1. **NEVER skip risk tolerance questions** - Even for presets
2. **NEVER proceed without explicit risk limits** - No defaults
3. **ALWAYS wait for each wave** - Max 3 parallel agents per wave
4. **ALWAYS verify safety controls** - Audit must pass
5. **ALWAYS start in dry run** - Default DRY_RUN=true
6. **NEVER present incomplete bot** - All verifications must pass
7. **Sequential waves** - Do not start Wave N+1 before Wave N completes

## Wave Summary

| Wave | Agents | Focus | Max Parallel |
|------|--------|-------|--------------|
| 0 | - | Interrogation + risk tolerance | - |
| 1 | 3 | Polymarket API research | 3 |
| 2 | 3 | Risk & historical research | 3 |
| 3 | 3 | Contrarian & market analysis | 3 |
| 4 | - | Synthesis (orchestrator) | - |
| 5 | 1 | Code generation | 1 |
| 6 | 3 | Deep verification | 3 |

**Total: 13 spawned agents + orchestrator synthesis**
